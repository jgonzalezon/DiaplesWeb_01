@model DiaplesWeb.Controllers.RegistrationsVm
@{
    ViewData["Title"] = "Inscripciones";
    string q = Model.Query ?? "";
    int prev = Math.Max(1, Model.Page - 1);
    int next = Math.Min(Model.TotalPages, Model.Page + 1);
}

<div class="container">
    <header class="section-head" style="display:flex; justify-content:space-between; align-items:end; gap:16px; flex-wrap:wrap;">
        <div>
            <h2 class="section-title">Inscripciones</h2>
            <p class="section-sub">@Model.Total registros · página @Model.Page de @Model.TotalPages</p>
        </div>

        <form method="get" class="form" style="display:flex; gap:10px; align-items:center;">
            <input type="text" name="q" value="@q" placeholder="Buscar nombre o email…" class="input" style="min-width:260px" />
                <select name="pageSize" class="input">
                    @if (Model.PageSize == 10) { <option value="10" selected>10</option> } else { <option value="10">10</option> }
                    @if (Model.PageSize == 20) { <option value="20" selected>20</option> } else { <option value="20">20</option> }
                    @if (Model.PageSize == 50) { <option value="50" selected>50</option> } else { <option value="50">50</option> }
                </select>

            <button class="btn" type="submit">Filtrar</button>
            <a class="btn" asp-controller="Home" asp-action="DownloadRegistrations">Descargar CSV</a>
        </form>
    </header>

    <div class="table-card">
        <div class="table-scroll">
            <table class="table">
                <thead>
                    <tr>
                        <th>Fecha (UTC)</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Experiencia</th>
                        <th>Plan</th>
                        <th style="min-width:320px">Mensaje</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Items.Count == 0)
                {
                    <tr><td colspan="6" style="text-align:center; color:var(--muted)">No hay resultados.</td></tr>
                }
                else
                {
                    foreach (var r in Model.Items)
                    {
                        <tr>
                            <td>@r.CreatedAtUtc</td>
                            <td>@r.Name</td>
                            <td><a href="mailto:@r.Email">@r.Email</a></td>
                            <td>@r.Experience</td>
                            <td>@r.Plan</td>
                            <td>@r.Message</td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>

    <nav class="pager">
        <a class="btn ghost" href="@Url.Action("Registrations", new { page = 1, pageSize = Model.PageSize, q = q })">« Primera</a>
        <a class="btn ghost" href="@Url.Action("Registrations", new { page = prev, pageSize = Model.PageSize, q = q })">‹ Anterior</a>
        <span class="pager-info">Pág. @Model.Page / @Model.TotalPages</span>
        <a class="btn ghost" href="@Url.Action("Registrations", new { page = next, pageSize = Model.PageSize, q = q })">Siguiente ›</a>
        <a class="btn ghost" href="@Url.Action("Registrations", new { page = Model.TotalPages, pageSize = Model.PageSize, q = q })">Última »</a>
    </nav>
</div>
